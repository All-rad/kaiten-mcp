<!--
═══════════════════════════════════════════════════════════════════════════════
SYNC IMPACT REPORT
═══════════════════════════════════════════════════════════════════════════════
Version Change: 1.1.0 → 1.2.0
Creation Date: 2026-01-31
Last Amended: 2026-02-01

Principles Defined:
  1. Скорость и Простота (Speed and Simplicity)
  2. Использование Языков (Language Usage)
  3. Архитектура и Код (Architecture and Code)
  4. Тестирование (Testing)
  5. Обработка Ошибок (Error Handling)

Modified Sections:
  - Технологический Стек: добавлена секция "Локальная среда разработки" с требованиями по `sdkman`/`nvm` и проверке версий
  - Governance: ранее добавлена политика Pull Request / Commit-ов (один PR = один коммит)

Sections Added:
  - Технологический Стек (Technology Stack) — обновлено
  - Структура Проекта (Project Structure)
  - Документация (Documentation)
  - Поведение ИИ (AI Behavior)

Template Consistency Check:
  ✅ plan-template.md - UPDATED to require local env version checks in Constitution Check
  ✅ spec-template.md - Requirements align with testing and documentation principles
  ✅ tasks-template.md - UPDATED to include setup task to verify and set local env versions
  ✅ agent files - UPDATED to include PR policy and local environment guidance

Follow-up Actions:
  - Add CI/hook to check environment versions where feasible
  - Verify agent guidance files respect Russian language requirement for docs/logging and PR policy

═══════════════════════════════════════════════════════════════════════════════
-->

# Kaiten-MCP Constitution

## Основные Принципы (Core Principles)

### I. Скорость и Простота
**NON-NEGOTIABLE**: Приоритет скорости разработки и простоты решений над всеми остальными аспектами.

**MUST**:
- Читаемость и лёгкость модификации имеют приоритет над производительностью
- Следовать принципу наименьшего действия: решать только текущую задачу минимально достаточным набором изменений
- Избегать преждевременной оптимизации и излишней сложности

**Обоснование**: Быстрая итерация и простота поддержки критичны для успеха проекта. Оптимизация производится только при наличии доказанных проблем производительности.

### II. Использование Языков
**NON-NEGOTIABLE**: Строгое разделение языков по типу контента.

**MUST использовать русский язык для**:
- Всей документации проекта
- Документации в коде (комментарии, docstrings)
- Всех взаимодействий с пользователем (UI, сообщения, CLI)
- Всего логирования (log messages, error messages)

**MUST использовать английский язык для**:
- Имён переменных, функций, классов, методов
- Названий файлов и директорий
- Commit messages
- Технических идентификаторов
- API endpoints и контрактов

**Обоснование**: Обеспечивает понятность для целевой аудитории (русскоязычные пользователи) при сохранении международных стандартов именования кода.

### III. Архитектура и Код
**NON-NEGOTIABLE**: Следование установленным принципам проектирования и стандартам качества кода.

**MUST**:
- Самодокументируемый код (self-documenting code) — имена переменных и функций должны четко отражать их назначение
- Следование принципам SOLID для объектно-ориентированного кода
- Следование принципам DRY (Don't Repeat Yourself) и KISS (Keep It Simple, Stupid)
- Нетерпимость к null: если null — валидный вариант значения, оно ДОЛЖНО быть `Optional`
- Всегда использовать полные импорты без wildcards (например, `import x.y.Z` вместо `import x.y.*`)

**Обоснование**: Эти принципы обеспечивают maintainability, reduce bugs, и упрощают onboarding новых разработчиков.

### IV. Тестирование
**Подход**: Только unit-тесты с фокусом на публичное API.

**MUST**:
- Писать только unit-тесты
- НЕ тестировать приватные методы
- Если логика явно обособлена и может тестироваться отдельно — выделять её в отдельный класс/модуль с публичным API и покрывать unit-тестами

**MUST NOT**:
- НИКОГДА не писать тесты, инициализирующие Spring контекст, даже частично
- Не писать интеграционные тесты без явного требования

**Обоснование**: Unit-тесты обеспечивают быстрый feedback loop. Тесты Spring контекста медленные и хрупкие, противоречат принципу скорости.

### V. Обработка Ошибок
**Подход**: Минималистичная обработка ошибок, обрабатывать только то, что действительно нужно обработать.

**MUST**:
- Обрабатывать ошибки только когда понятно КАК и ЗАЧЕМ их обработать в текущем контексте
- НЕ перехватывать ошибки для логирования в бизнес-логике
- НЕ перехватывать ошибки для rethrow в бизнес-логике (rethrow разрешён только на стыке слоёв по модели clean architecture)
- Системные ошибки НЕ должны доходить до пользователя — только логироваться

**Обоснование**: Избыточная обработка ошибок засоряет код и затрудняет debugging. Централизованная обработка на границах системы предпочтительнее.

## Технологический Стек (Technology Stack)

**Backend**:
- Java 21
- Spring Boot 3.5.x
- SQLite

**Frontend**:
- React
- TypeScript

**Тестирование**:
- JUnit 5
- Mockito

## Локальная среда разработки (Local Development Environment)

**MUST**:
- Для настройки локальной Java среды использовать `sdkman` (https://sdkman.io/). Устанавливать и переключаться на версию Java, указанную в проекте.
- Для настройки локальной JavaScript/Node среды использовать `nvm` (https://github.com/nvm-sh/nvm). Устанавливать и переключаться на версию Node, указанную в проекте.
- Перед началом локальной разработки или тестирования **MUST** проверить версии инструментов (Java, Node, npm и т.д.) и при отклонении от версий, используемых в проекте, выставить нужные версии через `sdkman`/`nvm`.
- Требуемые версии ДОЛЖНЫ быть задокументированы в `docs/quickstart.md` и при необходимости в `specs/[###-feature]/quickstart.md` для фич с особыми требованиями.

**Обоснование**: Обеспечивает воспроизводимость сборки, уменьшает ошибки, связанные с окружением, и ускоряет процесс онбординга.

**Доставка**:
- Сборка в независимое приложение
- Поставка в виде ZIP-архива
- Должно запускаться на Windows и Linux кликом по исполняемому файлу/скрипту

**Version**: 1.2.0 | **Ratified**: 2026-01-31 | **Last Amended**: 2026-02-01

## Структура Проекта (Project Structure)

**MUST**:
- Отдельные директории `backend/` и `ui/` для backend и frontend части соответственно
- В корне репозитория: `README.md` и скрипты для сборки всего приложения
- Вся документация ДОЛЖНА храниться в `docs/` в корне репозитория

**Обоснование**: Чёткое разделение concerns упрощает навигацию и сборку проекта.

## Документация (Documentation)

**Фокус**: Бизнес-логика и взаимодействие компонентов, а не детали реализации.

**MUST**:
- Документация должна покрывать бизнес-логику и взаимодействие компонентов
- НЕ углубляться в детали реализации
- Отвечать на вопросы "Что?" и "Как?"
- **НИКОГДА** не отвечать на вопрос "Почему?" (обоснование относится к принятию решений, не к документации)
- Документация по дизайну и фичам ДОЛЖНА включать диаграммы, описывающие процесс и взаимодействия
- Использовать синтаксис PlantUML для диаграмм: https://plantuml.com/en/

**Обоснование**: Документация должна быть актуальной и не дублировать информацию, которую код выражает сам. Диаграммы обеспечивают быстрое понимание архитектуры.

## Поведение ИИ (AI Behavior)

**При работе с кодом и документацией, ИИ-ассистент MUST соблюдать**:

**Лаконичность**:
- Не объяснять очевидное
- Давать прямые ответы без лишних вводных

**Планирование**:
- Перед написанием кода сначала описать план действий в 3-5 пунктах
- План должен быть кратким и конкретным

**Подведение итогов**:
- НЕ составлять summary, changelog или иные документы, описывающие результаты работы, если это не написано как требование в задаче
- Сообщать только о завершении работы и критичных изменениях

**Обоснование**: ИИ должен быть эффективным инструментом, не создающим информационный шум. Избыточная документация процесса замедляет работу.

## Governance

**Авторитет конституции**:
- Эта конституция имеет приоритет над всеми остальными практиками и соглашениями
- Все изменения в коде и документации должны соответствовать принципам конституции
- При конфликте между конституцией и внешними best practices, следовать конституции

**Изменения конституции**:
- Изменения требуют документирования в Sync Impact Report
- MAJOR версия: удаление или переопределение принципов (breaking changes)
- MINOR версия: добавление новых принципов или существенное расширение секций
- PATCH версия: уточнения формулировок, исправление опечаток, несемантические улучшения

**Политика Pull Request и Commit-ов**:
**MUST**:
- Каждый Pull Request (PR) ДОЛЖЕН содержать ровно один коммит.
- Commit messages ДОЛЖНЫ быть на английском языке.
- Если после открытия PR требуется внести дополнительные фиксы, их ДОЛЖНО вносить через `git commit --amend` или интерактивный `git rebase` так, чтобы PR оставался одним коммитом до слияния.
- НЕЛЬЗЯ добавлять дополнительные коммиты или создавать новые PR для последовательных фиксов одной и той же задачи.

**Обоснование**: Сдерживает разрастание истории коммитов, упрощает ревью и откат изменений, соответствует принципу скорости и простоты.

**Проверка соответствия**:
- Все feature specifications должны включать проверку на соответствие принципам
- При обосновании отклонений от принципов использовать Complexity Tracking таблицу в implementation plan
- Используйте guidance в agent files для обеспечения соблюдения конституции в runtime

**Version**: 1.2.0 | **Ratified**: 2026-01-31 | **Last Amended**: 2026-02-01
